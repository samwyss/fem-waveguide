\section{Mathematical Model}
\label{sec:mathmod}

To model these systems \textit{in silico},

\subsubsection{Governing Equations}
\label{subsub:goveq}

The frequency domain Maxwell's Equations in the absence of electric or fictitious magnetic currents are,
\begin{align}
	\nabla \times \textbf{E} = -j\omega\textbf{B},
	\label{eq:faraday}
\end{align}
and
\begin{align}
	\nabla \times \textbf{H} = -j\omega\textbf{D}
	\label{eq:ampere}
\end{align}
where \textbf{E} is the electric field intensity, \textbf{B} is the magnetic flux density, \textbf{H} is the magnetic field intensity, and \textbf{D} is the electric flux density.

For a homogenous, infinite waveguide filled with a non-dispersive dielectric, \textbf{B} and \textbf{D} can be rewritten as
\begin{align}
	\textbf{B} = \mu \textbf{H},
	\label{eq:corH}
\end{align}
and
\begin{align}
	\textbf{D} = \epsilon \textbf{E}.
	\label{eq:corE}
\end{align}

These constitutive relations can now be used to simplify (\ref{eq:faraday}-\ref{eq:ampere}) as in 
\begin{align}
	\nabla \times \textbf{E} = -j\omega\mu\textbf{H},
	\label{eq:faraday_reduced}
\end{align}
and
\begin{align}
	\nabla \times \textbf{H} = -j\omega\epsilon\textbf{E}.
	\label{eq:ampere_reduced}
\end{align}

In the case of the infinite waveguide, the TM and TE modes can be fully solving for $E_z$ and $H_z$ respectively as all other field components can be derived from these two transverse fields \cite{rothlecnotes}-\cite{jin2011theory}. With this, (\ref{eq:faraday_reduced}-\ref{eq:ampere_reduced}) can be manipulated to solve for two independent 2-dimensional Helmholtz equations as
\begin{align}
	\nabla_t^2 E_z+k_c^2E_z=0 \quad \mathrm{on} \ \Omega,
	\label{eq:tm_helmholtz}
\end{align}
and
\begin{align}
	\nabla_t^2 H_z+k_c^2H_z=0 \quad \mathrm{on} \ \Omega
	\label{eq:te_helmholtz}
\end{align}
where $\nabla_t^2=\partial^2_x+\partial^2_y$ the the trasverse Laplacian operator in cartesian coordinates, $k_c^2=\omega^2\mu\epsilon+k_z^2$ is the cutoff wave number, $k_z$ is the wavenumber in the direction of propagation, and $\Omega$ denotes all non-boundary locations within the simulation domain.

These relations hold for all locations excluding those on the PEC walls of the waveguide. This PEC wall condition manifests in the form of a Dirichlet boundary condition
\begin{align}
	E_z=0 \quad \mathrm{on} \ \partial\Omega
	\label{eq:diriclet_tm}
\end{align}
for the TM mode and Neumann boundary conditions
\begin{align}
	\partial_x H_z = 0,\ \partial_y H_z = 0 \quad \mathrm{on} \ \partial\Omega
\end{align}
for the TE mode where $\partial\Omega$ denotes the PEC surface surrounding the waveguide.

\subsubsection{Galerkin Weak Formulation}
\label{subsub:galerkin_weak}
With the governing equations established, we can now proceed with the discretization of an arbitrarily shaped waveguide to solve for both the transverse electric and magnetic fields. Using FEM, we break these 2D waveguide slices into a finite set of finitely sized elements and approximate the solution of (\ref{eq:tm_helmholtz}-\ref{eq:te_helmholtz}) over each element. Triangular elements are chosen as they can be meshed together to form the boundaries of arbitrarily curved shapes well making them ideal for modeling geometries with no analytic solutions \cite{jin2011theory}. Linearly interpolating functions are used to approximate the solution of (\ref{eq:tm_helmholtz}-\ref{eq:te_helmholtz}) at the nodes of each element. Linear interpolating functions are chosen for their overall simplicity and adequate accuracy for the determination of waveguide parameters \cite{rothlecnotes}\cite{jin2011theory}. 

For an arbitrary triangular element, an generic scalar field $\phi$ can be Linearly interpolated over using
\begin{align}
	\phi^{(e)}(x,y)=a+bx+cy
	\label{eq:basic-el-interp}
\end{align} 
where $(e)$ refers to a specific element, $a$, $b$, $c$ are scaling constants and $x$, $y$ are the coordinates of the location within the node \cite{jin2011theory}. This interpolation scheme can now be applied to find the field value at an arbitrary vertex on the element as
\begin{align}
	\phi^{(e)}_l=a+bx_l+cy_l
	\label{eq:node-interp}
\end{align}
where $x$, $y$ are the coordinates of the node \cite{jin2011theory}. These nodal field expressions can now be combined to rewrite (\ref{eq:basic-el-interp}) in terms of the field value calculated at each node as
\begin{multline}
	\phi^{(e)}(x,y)=N_1^{(e)}(x,y)\phi^{(e)}_1\\+N_2^{(e)}(x,y)\phi^{(e)}_2+N_3^{(e)}(x,y)\phi^{(e)}_3
	\label{eq:elementinterp}
\end{multline} with an arbitrary interpolating function $N_l^{(e)}$ given by 
\begin{align}
	N_l^{(e)}(x,y)=\frac{1}{2\Delta^{(e)}}\left(a_l^{(e)}+b_l^{(e)}x+c_l^{(e)}y\right)
\end{align}
where $\Delta^{(e)}$ is the area of element $e$ and $a_l^{(e)}$, $b_l^{(e)}$, $c_l^{(e)}$ are given by the following as in \cite{jin2011theory}
\begin{multline}
	\quad \ \ \ a_1^{e} = x^{e}_2y^{e}_3-x^{e}_3y^{e}_2,b_1^{e}=y^{e}_2-y^{e}_3, c_1^{e}=x^{e}_3-y^{e}_2
	\\
	a_2^{e} = x^{e}_3y^{e}_1-x^{e}_1y^{e}_3,b_2^{e}=y^{e}_3-y^{e}_1, c_2^{e}=x^{e}_1-y^{e}_3
	\\
	a_3^{e} = x^{e}_1y^{e}_2-x^{e}_2y^{e}_1,b_3^{e}=y^{e}_1-y^{e}_2, c_3^{e}=x^{e}_2-y^{e}_1.
	\label{eq:coefficients}
\end{multline}

With definitions (\ref{eq:elementinterp}-\ref{eq:coefficients}) an arbitrary field with potential Dirichlet boundary conditions (noted by $D$) can be expressed as the superposition of all fields at each node as 
\begin{align}
	\phi=\sum_{j=1}^{N}N_j\phi_j\sum_{j=1}^{N}N_j^D\phi_j^D
\end{align}

With the discretization of a generic field outlined, The Galerkin weak forms of (\ref{eq:tm_helmholtz}-\ref{eq:te_helmholtz}) will now be derived in parallel. We begin by multiplying (\ref{eq:tm_helmholtz}-\ref{eq:te_helmholtz}) by a weighting function which is identical to that of an interpolating funcion for the Galerkin procedure. The resulting weak forms are


\subsubsection{Finite Element Matrix Assembly}
\label{subsub:mat_assembly}